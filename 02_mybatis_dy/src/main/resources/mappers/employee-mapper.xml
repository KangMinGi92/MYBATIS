<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="employee">
	<resultMap id="empMap" type="emp">
		<id property="empId" column="emp_id"/>
		<result property="empName" column="EMP_NAME"/>
		<result property="empNo" column="EMP_NO"/>
		<result property="deptCode" column="DEPT_CODE"/>
		<result property="jobCode" column="JOB_CODE"/>
		<result property="salLevel" column="SAL_LEVEL"/>
		<result property="managerId" column="MANAGER_ID"/>
		<result property="hireDate" column="HIRE_DATE"/>
		<result property="entDate" column="ENT_DATE"/>
		<result property="entYn" column="ENT_YN"/>
		<result property="deptId" column="DEPT_ID"/>
		<result property="deptTitle" column="DEPT_TITLE"/>
		<result property="locationId" column="LOCATION_ID"/>
		<result property="jobName" column="JOB_NAME"/>
	</resultMap>
	<select id="selectAllEmp" resultMap="empMap">
		SELECT * FROM EMPLOYEE JOIN DEPARTMENT ON DEPT_CODE=DEPT_ID JOIN JOB USING(JOB_CODE)
	</select>
	<!--
		파라미터값을 가져올때
		#{} : setType()값을 대입 -> 자료형에 맞는 리터럴을 대입 -> 'emp_id'  	
		${} : 문자열처리하는 표현 -> emp_id
	-->
	<select id="searchEmp" resultMap="empMap" parameterType="map">
		SELECT * FROM
			(SELECT E.*,
				DECODE(SUBSTR(EMP_NO,8,1),'1','M','2','F','3','M','4','F') AS GENDER FROM EMPLOYEE E) 
			JOIN DEPARTMENT ON DEPT_CODE=DEPT_ID
			JOIN JOB USING(JOB_CODE)
		WHERE 1=1
		<!--무조건 TRUE 인 값을 강제로 삽입해서 <where>태그 나 <trim>태그를 안써줄수도 있다.  -->
		<!-- <where> -->
		<!-- <trim prefix="WHERE" prefixOverrides="AND|OR"> --> 
		<!--map에 있는 keyword값이 null이 아니고, 공란이 아닐경우 분기처리 jsp 폼태그 안에 있는 값은 입력하지 않아도 공란으로 넘어오기 때문에 처리해줘야함-->
		<if test="keyword!=null and keyword!=''">
			AND ${type} LIKE '%${keyword}%'
		</if>
		<if test="gender!=null and gender!=''">
		 	AND GENDER = #{gender}
		 </if>
		 <if test="salary!=null and salary!='' and salFlag!=null and salFlag!=''">
<!-- 		<if test="salFlag eq 'ge'">
			 	AND SALARY >= #{salary}
			 	AND SALARY &gt;= #{salary}
			 </if>
			 <if test="salFlag=='le'">
			 	AND SALARY <![CDATA[<=]]> #{salary}
			 	AND SALARY &lt;= #{salary}
			 </if> -->
			 <choose>
			 	<when test="salFlag eq 'ge'">
			 			AND SALARY &gt;= #{salary}
			 	</when>
			 	<otherwise>
			 			AND SALARY &lt;= #{salary}
			 	</otherwise>
			 </choose>
		 </if>
		 <if test="deptCodes!=null and deptCodes!=''">
		 	AND DEPT_CODE IN 
		 	<!--
		 		foreach문을 사용할 수 있다.
		 		속성 
		 		collection : 배열방식의 데이터
		 		item : 배열의 데이터를 저장하는 변수명
		 		open : 반복을 시작할때 출력할 값을 설정
		 		close : 반복을 끝났을때 출력할 값을 설정
		 		separator : 반복할때마다 출력할 값을 설정(구분자)
		 		index : 배열의 인덱스 번호를 저장하는 변수
		 	  -->
			 <foreach item="d" collection="deptCodes" open="(" close=")" separator=",">
			 	#{d}
			 </foreach>
		 </if>
		 <if test="jobCodes!=null and jobCodes!=''">
		 	AND JOB_CODE IN
		 	<foreach item="j" collection="jobCodes" open="(" close=")" separator=",">
		 		#{j}
		 	</foreach>
		 </if>
		 <if test="hireDate!=null and hireDate!=''">
			 <choose>
		 	<when test="hireFlag eq 'ge'">
		 			AND HIRE_DATE &gt;= #{hireDate}
		 	</when>
		 	<otherwise>
		 			AND HIRE_DATE &lt;= #{hireDate}
		 	</otherwise>
			 </choose>
		 </if>
		<!--  </trim> -->
		 <!-- </where> -->
	</select>
	
<!-- 	
	<resultMap id="employeeMap" type="com.mybatis.model.vo.Employee">
		<id property="empId" column="EMP_ID"/>
		<result property="empName" column="EMP_NAME"/>
		<result property="empNo" column="EMP_NO"/>
		<result property="email" column="EMAIL"/>
		<result property="phone" column="PHONE"/>
		<result property="deptCode" column="DEPT_CODE"/>
		<result property="jobCode" column="JOB_CODE"/>
		<result property="salLevel" column="SAL_LEVEL"/>
		<result property="salary" column="SALARY"/>
		<result property="bonus" column="BONUS"/>
		<result property="managerId" column="MANAGER_ID"/>
		<result property="hireDate" column="HIRE_DATE"/>
		<result property="entDate" column="ENT_DATE"/>
		<result property="entYn" column="ENT_YN"/>
	</resultMap>
	<select id="selectEmployeeCount" resultType="_int">
		SELECT COUNT(*) FROM EMPLOYEE	
	</select>
	<select id="SelectEmployeeAll" resultMap="employeeMap">
		SELECT * FROM EMPLOYEE ORDER BY EMP_NAME DESC
	</select> -->
</mapper>
